<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Usage â€¢ soilquality</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Usage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">soilquality</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to soilquality</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-usage.html">Advanced Usage</a></li>
    <li><a class="dropdown-item" href="../articles/ahp-matrices.html">AHP Matrices Guide</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ccarbajal16/soilquality"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Advanced Usage</h1>
                        <h4 data-toc-skip class="author">soilquality
package</h4>
            
            <h4 data-toc-skip class="date">2025-12-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ccarbajal16/soilquality/blob/master/vignettes/advanced-usage.Rmd" class="external-link"><code>vignettes/advanced-usage.Rmd</code></a></small>
      <div class="d-none name"><code>advanced-usage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers advanced features of the soilquality package,
including:</p>
<ul>
<li>Property selection strategies</li>
<li>Custom scoring rules</li>
<li>Creating and using AHP matrices</li>
<li>Advanced visualization options</li>
<li>Working with different data formats</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ccarbajal16/soilquality" class="external-link">soilquality</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="property-selection-strategies">Property Selection Strategies<a class="anchor" aria-label="anchor" href="#property-selection-strategies"></a>
</h2>
<p>Choosing the right soil properties is crucial for meaningful SQI
calculation. The package offers several approaches.</p>
<div class="section level3">
<h3 id="strategy-1-use-pre-defined-property-sets">Strategy 1: Use Pre-defined Property Sets<a class="anchor" aria-label="anchor" href="#strategy-1-use-pre-defined-property-sets"></a>
</h3>
<p>The package includes curated property sets for common scenarios:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View available property sets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">soil_property_sets</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "basic"         "standard"      "comprehensive" "physical"     </span></span>
<span><span class="co">#&gt; [5] "chemical"      "fertility"</span></span>
<span></span>
<span><span class="co"># Compare different property sets</span></span>
<span><span class="va">result_basic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">soil_property_sets</span><span class="op">$</span><span class="va">basic</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use only fertility properties that exist in the dataset</span></span>
<span><span class="va">fertility_available</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">fertility</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result_fertility</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">fertility_available</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare mean SQI values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Basic properties - Mean SQI:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_basic</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Basic properties - Mean SQI: 0.49</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Fertility properties - Mean SQI:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_fertility</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fertility properties - Mean SQI: 0.508</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="strategy-2-domain-specific-selection">Strategy 2: Domain-Specific Selection<a class="anchor" aria-label="anchor" href="#strategy-2-domain-specific-selection"></a>
</h3>
<p>Select properties based on your research question or management
goal:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For erosion risk assessment - focus on physical properties</span></span>
<span><span class="va">erosion_props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sand"</span>, <span class="st">"Silt"</span>, <span class="st">"Clay"</span>, <span class="st">"BD"</span>, <span class="st">"OM"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_erosion</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">erosion_props</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For nutrient management - focus on fertility</span></span>
<span><span class="va">nutrient_props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_nutrient</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">nutrient_props</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare selected MDS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Erosion assessment MDS:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">result_erosion</span><span class="op">$</span><span class="va">mds</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Erosion assessment MDS: Sand, Clay, BD, OM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Nutrient management MDS:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">result_nutrient</span><span class="op">$</span><span class="va">mds</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Nutrient management MDS: N, K, P, pH, OM</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="strategy-3-data-driven-selection">Strategy 3: Data-Driven Selection<a class="anchor" aria-label="anchor" href="#strategy-3-data-driven-selection"></a>
</h3>
<p>Let PCA automatically select the most informative properties:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use all available numeric properties</span></span>
<span><span class="va">all_numeric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">soil_ucayali</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">result_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">all_numeric</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See which properties were selected by PCA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"PCA selected:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_all</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span>, <span class="st">"indicators from"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">all_numeric</span><span class="op">)</span>, <span class="st">"properties\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; PCA selected: 8 indicators from 14 properties</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_all</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sand" "Silt" "Ca"   "SOC"  "OM"   "pH"   "Mg"   "P"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="strategy-4-correlation-based-pre-screening">Strategy 4: Correlation-Based Pre-screening<a class="anchor" aria-label="anchor" href="#strategy-4-correlation-based-pre-screening"></a>
</h3>
<p>Remove highly correlated properties before analysis:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate correlation matrix</span></span>
<span><span class="va">numeric_data</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">soil_ucayali</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">numeric_data</span>, use <span class="op">=</span> <span class="st">"complete.obs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find highly correlated pairs (|r| &gt; 0.9)</span></span>
<span><span class="va">high_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.9</span> <span class="op">&amp;</span> <span class="va">cor_matrix</span> <span class="op">&lt;</span> <span class="fl">1</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">high_cor</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Highly correlated property pairs:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">high_cor</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">high_cor</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">high_cor</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># Avoid duplicates</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s - %s: r = %.3f\n"</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span><span class="op">[</span><span class="va">high_cor</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">)</span><span class="op">[</span><span class="va">high_cor</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                  <span class="va">cor_matrix</span><span class="op">[</span><span class="va">high_cor</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">high_cor</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Remove one from each highly correlated pair</span></span>
<span><span class="co"># For example, keep SOC but remove OM (they're highly correlated)</span></span>
<span><span class="va">reduced_props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">all_numeric</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OM"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">reduced_props</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="custom-scoring-rules">Custom Scoring Rules<a class="anchor" aria-label="anchor" href="#custom-scoring-rules"></a>
</h2>
<p>The package provides flexible scoring functions to match different
soil property behaviors.</p>
<div class="section level3">
<h3 id="higher-is-better">Higher is Better<a class="anchor" aria-label="anchor" href="#higher-is-better"></a>
</h3>
<p>For properties where higher values indicate better soil quality:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Organic matter, nutrients, CEC</span></span>
<span><span class="va">scoring_rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  N <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  P <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  CEC <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_higher</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scoring_rules</span><span class="op">)</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">scoring_rules</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lower-is-better">Lower is Better<a class="anchor" aria-label="anchor" href="#lower-is-better"></a>
</h3>
<p>For properties where lower values indicate better soil quality:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bulk density, electrical conductivity</span></span>
<span><span class="va">scoring_rules_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  BD <span class="op">=</span> <span class="fu"><a href="../reference/lower_better.html">lower_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  EC <span class="op">=</span> <span class="fu"><a href="../reference/lower_better.html">lower_better</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scoring_rules_lower</span><span class="op">)</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">scoring_rules_lower</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimum-range">Optimum Range<a class="anchor" aria-label="anchor" href="#optimum-range"></a>
</h3>
<p>For properties with an ideal target value:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pH has an optimal range around neutral</span></span>
<span><span class="va">scoring_rules_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pH <span class="op">=</span> <span class="fu"><a href="../reference/optimum_range.html">optimum_range</a></span><span class="op">(</span>optimal <span class="op">=</span> <span class="fl">6.5</span>, tolerance <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  Sand <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  Clay <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scoring_rules_opt</span><span class="op">)</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">scoring_rules_opt</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare pH scoring with different optimal values</span></span>
<span><span class="va">result_opt_7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span><span class="op">)</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pH <span class="op">=</span> <span class="fu"><a href="../reference/optimum_range.html">optimum_range</a></span><span class="op">(</span>optimal <span class="op">=</span> <span class="fl">7.0</span>, tolerance <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>    OM <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    N <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    P <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean SQI with pH optimum 6.5:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_opt</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean SQI with pH optimum 6.5: 0.395</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean SQI with pH optimum 7.0:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_opt_7</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean SQI with pH optimum 7.0: 0.336</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="threshold-based-scoring">Threshold-Based Scoring<a class="anchor" aria-label="anchor" href="#threshold-based-scoring"></a>
</h3>
<p>For properties with specific threshold values:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: P availability with agronomic thresholds</span></span>
<span><span class="co"># Low: &lt;10, Medium: 10-20, High: 20-40, Very High: &gt;40</span></span>
<span><span class="va">scoring_rules_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  P <span class="op">=</span> <span class="fu"><a href="../reference/threshold_scoring.html">threshold_scoring</a></span><span class="op">(</span></span>
<span>    thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>    scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fu"><a href="../reference/threshold_scoring.html">threshold_scoring</a></span><span class="op">(</span></span>
<span>    thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>    scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  pH <span class="op">=</span> <span class="fu"><a href="../reference/optimum_range.html">optimum_range</a></span><span class="op">(</span>optimal <span class="op">=</span> <span class="fl">6.5</span>, tolerance <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scoring_rules_thresh</span><span class="op">)</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">scoring_rules_thresh</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mixed-scoring-strategies">Mixed Scoring Strategies<a class="anchor" aria-label="anchor" href="#mixed-scoring-strategies"></a>
</h3>
<p>Combine different scoring approaches for comprehensive
assessment:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Realistic scoring for tropical agricultural soils</span></span>
<span><span class="va">tropical_scoring</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pH <span class="op">=</span> <span class="fu"><a href="../reference/optimum_range.html">optimum_range</a></span><span class="op">(</span>optimal <span class="op">=</span> <span class="fl">6.0</span>, tolerance <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  SOC <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  N <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  P <span class="op">=</span> <span class="fu"><a href="../reference/threshold_scoring.html">threshold_scoring</a></span><span class="op">(</span></span>
<span>    thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>    scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fu"><a href="../reference/threshold_scoring.html">threshold_scoring</a></span><span class="op">(</span></span>
<span>    thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, <span class="fl">120</span>, <span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>    scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  CEC <span class="op">=</span> <span class="fu"><a href="../reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  BD <span class="op">=</span> <span class="fu"><a href="../reference/lower_better.html">lower_better</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  EC <span class="op">=</span> <span class="fu"><a href="../reference/lower_better.html">lower_better</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_tropical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tropical_scoring</span><span class="op">)</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">tropical_scoring</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Tropical scoring - Mean SQI:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_tropical</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Tropical scoring - Mean SQI: 0.493</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="creating-ahp-matrices">Creating AHP Matrices<a class="anchor" aria-label="anchor" href="#creating-ahp-matrices"></a>
</h2>
<p>The Analytic Hierarchy Process (AHP) allows expert-based weighting of
indicators.</p>
<div class="section level3">
<h3 id="method-1-interactive-creation">Method 1: Interactive Creation<a class="anchor" aria-label="anchor" href="#method-1-interactive-creation"></a>
</h3>
<p>Create a pairwise comparison matrix interactively:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will prompt you for pairwise comparisons</span></span>
<span><span class="va">indicators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span></span>
<span><span class="va">ahp_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_ahp_matrix.html">create_ahp_matrix</a></span><span class="op">(</span><span class="va">indicators</span>, mode <span class="op">=</span> <span class="st">"interactive"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the AHP matrix in SQI calculation</span></span>
<span><span class="va">result_ahp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">indicators</span>,</span>
<span>  pairwise_matrix <span class="op">=</span> <span class="va">ahp_matrix</span><span class="op">$</span><span class="va">matrix</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-2-manual-matrix-creation">Method 2: Manual Matrix Creation<a class="anchor" aria-label="anchor" href="#method-2-manual-matrix-creation"></a>
</h3>
<p>Create a pairwise comparison matrix manually:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define indicators</span></span>
<span><span class="va">indicators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create pairwise comparison matrix</span></span>
<span><span class="co"># Rows are compared to columns</span></span>
<span><span class="co"># Values: 1=Equal, 3=Moderate, 5=Strong, 7=Very Strong, 9=Extreme</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span>,   <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,  <span class="co"># pH compared to others</span></span>
<span>  <span class="fl">3</span>,   <span class="fl">1</span>,   <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span>,    <span class="co"># OM compared to others</span></span>
<span>  <span class="fl">5</span>,   <span class="fl">3</span>,   <span class="fl">1</span>,   <span class="fl">3</span>,    <span class="co"># N compared to others</span></span>
<span>  <span class="fl">3</span>,   <span class="fl">1</span>,   <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span>     <span class="co"># P compared to others</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pairwise</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pairwise</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">indicators</span></span>
<span></span>
<span><span class="co"># Calculate weights</span></span>
<span><span class="va">ahp_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ahp_weights.html">ahp_weights</a></span><span class="op">(</span><span class="va">pairwise</span>, indicators <span class="op">=</span> <span class="va">indicators</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Indicator weights:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Indicator weights:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ahp_result</span><span class="op">$</span><span class="va">weights</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    pH    OM     N     P </span></span>
<span><span class="co">#&gt; 0.078 0.200 0.522 0.200</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nConsistency Ratio:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ahp_result</span><span class="op">$</span><span class="va">CR</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Consistency Ratio: 0.0161</span></span>
<span></span>
<span><span class="co"># Note: To use AHP weights in SQI calculation, the pairwise matrix must match</span></span>
<span><span class="co"># the MDS indicators selected by PCA. For this example, we'll calculate SQI</span></span>
<span><span class="co"># with equal weights and show the AHP weights separately.</span></span>
<span><span class="va">result_manual_ahp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">indicators</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMDS indicators selected by PCA:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">result_manual_ahp</span><span class="op">$</span><span class="va">mds</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MDS indicators selected by PCA: N, pH, OM</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-3-importance-ratios">Method 3: Importance Ratios<a class="anchor" aria-label="anchor" href="#method-3-importance-ratios"></a>
</h3>
<p>Use relative importance ratios (simpler than full pairwise
matrix):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify relative importance (e.g., N is 3x more important than pH)</span></span>
<span><span class="va">indicators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span><span class="op">)</span></span>
<span><span class="va">importance_ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>  <span class="co"># Relative importance</span></span>
<span></span>
<span><span class="co"># Convert to pairwise matrix</span></span>
<span><span class="va">pairwise_from_ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ratio_to_saaty.html">ratio_to_saaty</a></span><span class="op">(</span><span class="va">importance_ratios</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pairwise_from_ratios</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pairwise_from_ratios</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">indicators</span></span>
<span></span>
<span><span class="co"># Calculate weights</span></span>
<span><span class="va">ahp_from_ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ahp_weights.html">ahp_weights</a></span><span class="op">(</span><span class="va">pairwise_from_ratios</span>, indicators <span class="op">=</span> <span class="va">indicators</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Weights from importance ratios:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Weights from importance ratios:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ahp_from_ratios</span><span class="op">$</span><span class="va">weights</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    pH    OM     N     P </span></span>
<span><span class="co">#&gt; 0.125 0.250 0.375 0.250</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-visualization">Advanced Visualization<a class="anchor" aria-label="anchor" href="#advanced-visualization"></a>
</h2>
<div class="section level3">
<h3 id="customizing-plot-appearance">Customizing Plot Appearance<a class="anchor" aria-label="anchor" href="#customizing-plot-appearance"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate SQI for visualization examples</span></span>
<span><span class="va">result_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Distribution plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_viz</span>, type <span class="op">=</span> <span class="st">"distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-usage_files/figure-html/custom-plots-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="comparing-multiple-scenarios">Comparing Multiple Scenarios<a class="anchor" aria-label="anchor" href="#comparing-multiple-scenarios"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate SQI with different property sets</span></span>
<span><span class="va">result_physical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">soil_property_sets</span><span class="op">$</span><span class="va">physical</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use only chemical properties that exist in the dataset</span></span>
<span><span class="va">chemical_available</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">chemical</span>, </span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result_chemical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">chemical_available</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare distributions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result_physical</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Physical Properties"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"SQI"</span>, col <span class="op">=</span> <span class="st">"lightblue"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_physical</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result_chemical</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Chemical Properties"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"SQI"</span>, col <span class="op">=</span> <span class="st">"lightgreen"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_chemical</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-usage_files/figure-html/compare-scenarios-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pca-biplot">PCA Biplot<a class="anchor" aria-label="anchor" href="#pca-biplot"></a>
</h3>
<p>Visualize relationships between samples and variables:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_viz</span>, type <span class="op">=</span> <span class="st">"biplot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-usage_files/figure-html/biplot-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level3">
<h3 id="indicator-contribution-analysis">Indicator Contribution Analysis<a class="anchor" aria-label="anchor" href="#indicator-contribution-analysis"></a>
</h3>
<p>Identify which indicators contribute most to SQI variation:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract scored indicators and weights</span></span>
<span><span class="va">scored_data</span> <span class="op">&lt;-</span> <span class="va">result_viz</span><span class="op">$</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">result_viz</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"_scored"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">result_viz</span><span class="op">$</span><span class="va">weights</span></span>
<span></span>
<span><span class="co"># Calculate weighted contribution of each indicator</span></span>
<span><span class="va">contributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">scored_data</span>, <span class="fl">2</span>, <span class="va">weights</span>, <span class="st">"*"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot contributions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">contributions</span>, </span>
<span>        main <span class="op">=</span> <span class="st">"Weighted Indicator Contributions to SQI"</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Weighted Score"</span>,</span>
<span>        las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_viz</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-usage_files/figure-html/indicator-contribution-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-different-data-formats">Working with Different Data Formats<a class="anchor" aria-label="anchor" href="#working-with-different-data-formats"></a>
</h2>
<div class="section level3">
<h3 id="file-based-workflow">File-Based Workflow<a class="anchor" aria-label="anchor" href="#file-based-workflow"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save data to CSV</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">soil_ucayali</span>, <span class="st">"soil_data.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate SQI from file</span></span>
<span><span class="va">result_from_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi.html">compute_sqi</a></span><span class="op">(</span></span>
<span>  input_csv <span class="op">=</span> <span class="st">"soil_data.csv"</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  output_csv <span class="op">=</span> <span class="st">"sqi_results.csv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Results are automatically saved to output_csv</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-frame-workflow">Data Frame Workflow<a class="anchor" aria-label="anchor" href="#data-frame-workflow"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Work directly with data frames (no file I/O)</span></span>
<span><span class="va">result_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_sqi_df.html">compute_sqi_df</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">sqi_values</span> <span class="op">&lt;-</span> <span class="va">result_df</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sqi_values</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">result_df</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SampleID</span></span>
<span></span>
<span><span class="co"># View top 5 samples by SQI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">sqi_values</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;    UCY043    UCY005    UCY001    UCY050    UCY045 </span></span>
<span><span class="co">#&gt; 0.6927483 0.6061193 0.5852834 0.5773329 0.5691887</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="batch-processing-multiple-datasets">Batch Processing Multiple Datasets<a class="anchor" aria-label="anchor" href="#batch-processing-multiple-datasets"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process multiple sites or time points</span></span>
<span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site1.csv"</span>, <span class="st">"site2.csv"</span>, <span class="st">"site3.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sites</span>, <span class="kw">function</span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/compute_sqi.html">compute_sqi</a></span><span class="op">(</span></span>
<span>    input_csv <span class="op">=</span> <span class="va">site</span>,</span>
<span>    id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>    properties <span class="op">=</span> <span class="va">soil_property_sets</span><span class="op">$</span><span class="va">standard</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare mean SQI across sites</span></span>
<span><span class="va">mean_sqi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">results_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mean_sqi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mean_sqi</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<div class="section level3">
<h3 id="property-selection">1. Property Selection<a class="anchor" aria-label="anchor" href="#property-selection"></a>
</h3>
<ul>
<li>Use at least 5-6 properties for robust PCA</li>
<li>Include properties from different categories (physical, chemical,
biological)</li>
<li>Avoid highly correlated properties (|r| &gt; 0.9)</li>
<li>Match properties to your management objectives</li>
</ul>
</div>
<div class="section level3">
<h3 id="scoring-rules">2. Scoring Rules<a class="anchor" aria-label="anchor" href="#scoring-rules"></a>
</h3>
<ul>
<li>Use domain knowledge to select appropriate scoring functions</li>
<li>Validate scoring rules with local experts or literature</li>
<li>Consider regional differences in optimal values</li>
<li>Document your scoring rationale</li>
</ul>
</div>
<div class="section level3">
<h3 id="ahp-weighting">3. AHP Weighting<a class="anchor" aria-label="anchor" href="#ahp-weighting"></a>
</h3>
<ul>
<li>Involve multiple experts for more reliable weights</li>
<li>Check Consistency Ratio (CR &lt; 0.1)</li>
<li>Use equal weights if expert knowledge is unavailable</li>
<li>Sensitivity analysis: test how results change with different
weights</li>
</ul>
</div>
<div class="section level3">
<h3 id="interpretation">4. Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<ul>
<li>Consider SQI in context of land use and management goals</li>
<li>Compare SQI across similar soil types or land uses</li>
<li>Use visualization to identify limiting factors</li>
<li>Validate results with field observations</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette demonstrated advanced features including:</p>
<ul>
<li>Multiple property selection strategies</li>
<li>Custom scoring rules for different property behaviors</li>
<li>Creating AHP matrices for expert-based weighting</li>
<li>Advanced visualization and comparison techniques</li>
<li>Different data workflow options</li>
</ul>
<p>For more information on AHP methodology, see
<code><a href="../articles/ahp-matrices.html">vignette("ahp-matrices")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Karlen, D. L., Mausbach, M. J., Doran, J. W., Cline, R. G.,
Harris, R. F., &amp; Schuman, G. E. (1997). Soil quality: A concept,
definition, and framework for evaluation. <em>Soil Science Society of
America Journal</em>, 61(1), 4-10.</p></li>
<li><p>Qi, Y., Darilek, J. L., Huang, B., Zhao, Y., Sun, W., &amp; Gu,
Z. (2009). Evaluating soil quality indices in an agricultural region of
Jiangsu Province, China. <em>Geoderma</em>, 149(3-4), 325-334.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Carlos Carbajal</p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a></p>
</div>

    </footer>
</div>





  </body>
</html>
