<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Comprehensive User Guide for the soilquality R Package • soilquality</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Comprehensive User Guide for the soilquality R Package"><meta property="og:image" content="https://ccarbajal16.github.io/soilquality/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">soilquality</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/introduction.html">Introduction to soilquality</a></li>
    <li><a class="dropdown-item" href="articles/advanced-usage.html">Advanced Usage</a></li>
    <li><a class="dropdown-item" href="articles/ahp-matrices.html">AHP Matrices Guide</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ccarbajal16/soilquality"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Comprehensive User Guide for the soilquality R Package</h1>
      <small class="dont-index">Source: <a href="https://github.com/ccarbajal16/soilquality/blob/master/USER_GUIDE.md" class="external-link"><code>USER_GUIDE.md</code></a></small>
    </div>

<div id="comprehensive-user-guide-for-the-soilquality-r-package" class="section level1">

<p><strong>Version 1.0.0</strong> <strong>Author: Carlos Carbajal</strong> <strong>Last Updated:</strong> December 2025</p>
<hr><div class="section level2">
<h2 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a></h2>
<ol style="list-style-type: decimal"><li><a href="#id_1-introduction">Introduction</a></li>
<li><a href="#id_2-theoretical-background">Theoretical Background</a></li>
<li><a href="#id_3-installation">Installation</a></li>
<li><a href="#id_4-dataset-description">Dataset Description</a></li>
<li><a href="#id_5-data-preparation">Data Preparation</a></li>
<li><a href="#id_6-principal-component-analysis-and-minimum-data-set-selection">Principal Component Analysis and Minimum Data Set Selection</a></li>
<li><a href="#id_7-analytic-hierarchy-process-for-indicator-weighting">Analytic Hierarchy Process for Indicator Weighting</a></li>
<li><a href="#id_8-scoring-functions-and-normalization">Scoring Functions and Normalization</a></li>
<li><a href="#id_9-complete-sqi-calculation-workflows">Complete SQI Calculation Workflows</a></li>
<li><a href="#id_10-visualization-and-results-interpretation">Visualization and Results Interpretation</a></li>
<li><a href="#id_11-advanced-applications">Advanced Applications</a></li>
<li><a href="#id_12-interactive-shiny-application">Interactive Shiny Application</a></li>
<li><a href="#id_13-best-practices-and-recommendations">Best Practices and Recommendations</a></li>
<li><a href="#id_14-references">References</a></li>
</ol><hr></div>
<div class="section level2">
<h2 id="id_1-introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#id_1-introduction"></a></h2>
<p>The <strong>soilquality</strong> package provides a comprehensive framework for calculating Soil Quality Index (SQI) using scientifically validated methodologies. This package implements a systematic approach combining multivariate statistical analysis with expert knowledge to transform complex soil property data into a single, interpretable quality metric.</p>
<div class="section level3">
<h3 id="id_11-key-features">1.1 Key Features<a class="anchor" aria-label="anchor" href="#id_11-key-features"></a></h3>
<ul><li>
<strong>Automated Minimum Data Set (MDS) Selection</strong>: Principal Component Analysis (PCA) based dimensionality reduction</li>
<li>
<strong>Expert Knowledge Integration</strong>: Analytic Hierarchy Process (AHP) for indicator weighting</li>
<li>
<strong>Flexible Scoring Systems</strong>: Multiple normalization methods for different soil property behaviors</li>
<li>
<strong>Comprehensive Visualization</strong>: Publication-ready graphics for results communication</li>
<li>
<strong>Interactive Interface</strong>: Shiny-based GUI for non-programming users</li>
<li>
<strong>Pre-defined Property Sets</strong>: Standard configurations for common soil analyses</li>
</ul></div>
<div class="section level3">
<h3 id="id_12-intended-audience">1.2 Intended Audience<a class="anchor" aria-label="anchor" href="#id_12-intended-audience"></a></h3>
<p>This package is designed for: - Soil scientists conducting quality assessments - Environmental researchers evaluating land management impacts - Agricultural consultants advising on soil health - Students learning soil quality assessment methodologies - Policy makers requiring standardized soil quality metrics</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_2-theoretical-background">2. Theoretical Background<a class="anchor" aria-label="anchor" href="#id_2-theoretical-background"></a></h2>
<div class="section level3">
<h3 id="id_21-soil-quality-index-concept">2.1 Soil Quality Index Concept<a class="anchor" aria-label="anchor" href="#id_21-soil-quality-index-concept"></a></h3>
<p>Soil quality is defined as the capacity of soil to function within ecosystem boundaries to sustain biological productivity, maintain environmental quality, and promote plant and animal health (Karlen et al., 1997). The Soil Quality Index (SQI) provides a quantitative measure of this capacity by integrating multiple soil indicators into a single value.</p>
<p>The SQI is calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>Q</mi><mi>I</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><mo>×</mo><msub><mi>S</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
SQI = \sum_{i=1}^{n} w_i \times S_i
</annotation></semantics></math></p>
<p>Where: - <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>i</mi></msub><annotation encoding="application/x-tex">w_i</annotation></semantics></math> = weight of indicator <em>i</em> - <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>i</mi></msub><annotation encoding="application/x-tex">S_i</annotation></semantics></math> = normalized score of indicator <em>i</em> (range: 0-1) - <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> = number of indicators in the Minimum Data Set</p>
</div>
<div class="section level3">
<h3 id="id_22-minimum-data-set-mds-selection">2.2 Minimum Data Set (MDS) Selection<a class="anchor" aria-label="anchor" href="#id_22-minimum-data-set-mds-selection"></a></h3>
<p>The MDS represents a reduced set of soil indicators that captures the maximum variance in the full dataset while minimizing redundancy. This package employs PCA to identify principal components that explain variance above a specified threshold, then selects the indicator with the highest loading from each retained component.</p>
</div>
<div class="section level3">
<h3 id="id_23-analytic-hierarchy-process-ahp">2.3 Analytic Hierarchy Process (AHP)<a class="anchor" aria-label="anchor" href="#id_23-analytic-hierarchy-process-ahp"></a></h3>
<p>AHP (Saaty, 1980) is a structured decision-making technique that derives indicator weights from pairwise comparisons. The method calculates weights using eigenvalue decomposition and provides a Consistency Ratio (CR) to assess the logical coherence of expert judgments. A CR &lt; 0.10 indicates acceptable consistency.</p>
</div>
<div class="section level3">
<h3 id="id_24-indicator-scoring-functions">2.4 Indicator Scoring Functions<a class="anchor" aria-label="anchor" href="#id_24-indicator-scoring-functions"></a></h3>
<p>Different soil properties exhibit distinct relationships with soil quality: - <strong>Higher-is-better</strong>: Properties like organic matter, nutrients (monotonic positive relationship) - <strong>Lower-is-better</strong>: Properties like bulk density, salinity (monotonic negative relationship) - <strong>Optimum range</strong>: Properties like pH with an optimal value (parabolic relationship) - <strong>Threshold-based</strong>: Properties with custom thresholds defining quality classes</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_3-installation">3. Installation<a class="anchor" aria-label="anchor" href="#id_3-installation"></a></h2>
<div class="section level3">
<h3 id="id_31-from-github-development-version">3.1 From GitHub (Development Version)<a class="anchor" aria-label="anchor" href="#id_31-from-github-development-version"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install devtools if not already installed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Install soilquality from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ccarbajal16/soilquality"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_32-load-the-package">3.2 Load the Package<a class="anchor" aria-label="anchor" href="#id_32-load-the-package"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ccarbajal16/soilquality" class="external-link">soilquality</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_33-optional-dependencies">3.3 Optional Dependencies<a class="anchor" aria-label="anchor" href="#id_33-optional-dependencies"></a></h3>
<p>For full functionality, install these suggested packages:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shiny"</span>, <span class="st">"DT"</span>, <span class="st">"knitr"</span>, <span class="st">"rmarkdown"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_4-dataset-description">4. Dataset Description<a class="anchor" aria-label="anchor" href="#id_4-dataset-description"></a></h2>
<div class="section level3">
<h3 id="id_41-the-soil_ucayali-dataset">4.1 The soil_ucayali Dataset<a class="anchor" aria-label="anchor" href="#id_41-the-soil_ucayali-dataset"></a></h3>
<p>The package includes a representative dataset from the Ucayali region of Peru containing 50 soil samples with 15 variables.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Examine structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span></span></code></pre></div>
<pre><code>'data.frame':   50 obs. of  15 variables:
 $ SampleID: chr  "UCY001" "UCY002" "UCY003" ...
 $ Sand    : num  45.8 48.3 41.2 ...
 $ Silt    : num  28.7 30.5 32.1 ...
 $ Clay    : num  25.5 21.2 26.7 ...
 $ BD      : num  1.32 1.45 1.28 ...
 $ pH      : num  5.2 5.8 4.9 ...
 $ OM      : num  2.85 2.45 3.15 ...
 $ SOC     : num  1.65 1.42 1.83 ...
 $ N       : num  0.145 0.125 0.168 ...
 $ P       : num  7.5 10.2 6.3 ...
 $ K       : num  92 115 78 ...
 $ CEC     : num  11.5 13.2 10.8 ...
 $ Ca      : num  4.35 5.12 3.87 ...
 $ Mg      : num  1.65 2.01 1.45 ...
 $ EC      : num  0.22 0.31 0.18 ...</code></pre>
</div>
<div class="section level3">
<h3 id="id_42-variable-definitions">4.2 Variable Definitions<a class="anchor" aria-label="anchor" href="#id_42-variable-definitions"></a></h3>
<table class="table"><thead><tr class="header"><th>Variable</th>
<th>Description</th>
<th>Unit</th>
<th>Type</th>
</tr></thead><tbody><tr class="odd"><td>SampleID</td>
<td>Unique sample identifier</td>
<td>-</td>
<td>Categorical</td>
</tr><tr class="even"><td>Sand</td>
<td>Sand content</td>
<td>%</td>
<td>Physical</td>
</tr><tr class="odd"><td>Silt</td>
<td>Silt content</td>
<td>%</td>
<td>Physical</td>
</tr><tr class="even"><td>Clay</td>
<td>Clay content</td>
<td>%</td>
<td>Physical</td>
</tr><tr class="odd"><td>BD</td>
<td>Bulk density</td>
<td>g/cm³</td>
<td>Physical</td>
</tr><tr class="even"><td>pH</td>
<td>Soil pH (1:1 water)</td>
<td>-</td>
<td>Chemical</td>
</tr><tr class="odd"><td>OM</td>
<td>Organic matter</td>
<td>%</td>
<td>Chemical</td>
</tr><tr class="even"><td>SOC</td>
<td>Soil organic carbon</td>
<td>%</td>
<td>Chemical</td>
</tr><tr class="odd"><td>N</td>
<td>Total nitrogen</td>
<td>%</td>
<td>Fertility</td>
</tr><tr class="even"><td>P</td>
<td>Available phosphorus (Olsen)</td>
<td>mg/kg</td>
<td>Fertility</td>
</tr><tr class="odd"><td>K</td>
<td>Exchangeable potassium</td>
<td>mg/kg</td>
<td>Fertility</td>
</tr><tr class="even"><td>CEC</td>
<td>Cation exchange capacity</td>
<td>cmol/kg</td>
<td>Chemical</td>
</tr><tr class="odd"><td>Ca</td>
<td>Exchangeable calcium</td>
<td>cmol/kg</td>
<td>Fertility</td>
</tr><tr class="even"><td>Mg</td>
<td>Exchangeable magnesium</td>
<td>cmol/kg</td>
<td>Fertility</td>
</tr><tr class="odd"><td>EC</td>
<td>Electrical conductivity</td>
<td>dS/m</td>
<td>Chemical</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_43-summary-statistics">4.3 Summary Statistics<a class="anchor" aria-label="anchor" href="#id_43-summary-statistics"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Descriptive statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_5-data-preparation">5. Data Preparation<a class="anchor" aria-label="anchor" href="#id_5-data-preparation"></a></h2>
<div class="section level3">
<h3 id="id_51-reading-soil-data-from-csv-files">5.1 Reading Soil Data from CSV Files<a class="anchor" aria-label="anchor" href="#id_51-reading-soil-data-from-csv-files"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read soil data with automatic encoding detection</span></span>
<span><span class="va">soil_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_soil_csv.html">read_soil_csv</a></span><span class="op">(</span><span class="st">"path/to/soil_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View first rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>read_soil_csv(path)</code></p>
<p><strong>Parameters</strong>: - <code>path</code>: Character string specifying the CSV file path</p>
<p><strong>Returns</strong>: Data frame with soil property data</p>
</div>
<div class="section level3">
<h3 id="id_52-type-conversion">5.2 Type Conversion<a class="anchor" aria-label="anchor" href="#id_52-type-conversion"></a></h3>
<p>Safely convert variables to numeric type:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert a column to numeric</span></span>
<span><span class="va">soil_data</span><span class="op">$</span><span class="va">pH</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/to_numeric.html">to_numeric</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">$</span><span class="va">pH</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Non-numeric values become NA with warning suppression</span></span></code></pre></div>
<p><strong>Function</strong>: <code>to_numeric(x)</code></p>
<p><strong>Parameters</strong>: - <code>x</code>: Vector of any type</p>
<p><strong>Returns</strong>: Numeric vector with NA for non-convertible values</p>
</div>
<div class="section level3">
<h3 id="id_53-standardization">5.3 Standardization<a class="anchor" aria-label="anchor" href="#id_53-standardization"></a></h3>
<p>Z-score standardization is essential prior to PCA:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standardize all numeric columns except ID</span></span>
<span><span class="va">soil_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standardize_numeric.html">standardize_numeric</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  exclude <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify standardization (mean ≈ 0, sd ≈ 1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">soil_std</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">soil_std</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>standardize_numeric(df, exclude = NULL)</code></p>
<p><strong>Parameters</strong>: - <code>df</code>: Data frame containing soil properties - <code>exclude</code>: Character vector of column names to exclude from standardization</p>
<p><strong>Returns</strong>: Data frame with standardized numeric columns</p>
<p><strong>Details</strong>: - Applies z-score transformation: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msub><mi>s</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">(x - \bar{x}) / s_x</annotation></semantics></math> - Preserves NA values - Non-numeric columns remain unchanged - Columns with zero variance are not standardized</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_6-principal-component-analysis-and-minimum-data-set-selection">6. Principal Component Analysis and Minimum Data Set Selection<a class="anchor" aria-label="anchor" href="#id_6-principal-component-analysis-and-minimum-data-set-selection"></a></h2>
<div class="section level3">
<h3 id="id_61-theoretical-foundation">6.1 Theoretical Foundation<a class="anchor" aria-label="anchor" href="#id_61-theoretical-foundation"></a></h3>
<p>PCA transforms correlated variables into uncorrelated principal components (PCs) ordered by explained variance. The MDS selection algorithm:</p>
<ol style="list-style-type: decimal"><li>Performs PCA on standardized data</li>
<li>Retains PCs explaining variance &gt; <code>var_threshold</code>
</li>
<li>For each retained PC, selects the variable with maximum absolute loading &gt; <code>loading_threshold</code>
</li>
<li>Returns unique set of selected variables</li>
</ol></div>
<div class="section level3">
<h3 id="id_62-basic-pca-mds-selection">6.2 Basic PCA-MDS Selection<a class="anchor" aria-label="anchor" href="#id_62-basic-pca-mds-selection"></a></h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example with 8 soil properties</span></span>
<span><span class="va">properties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sand"</span>, <span class="st">"Silt"</span>, <span class="st">"Clay"</span>, <span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span></span>
<span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">[</span>, <span class="va">properties</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Standardize first</span></span>
<span><span class="va">data_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standardize_numeric.html">standardize_numeric</a></span><span class="op">(</span><span class="va">data_subset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform PCA and select MDS</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pca_select_mds.html">pca_select_mds</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_std</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.05</span>,      <span class="co"># Retain PCs explaining &gt; 5% variance</span></span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.5</span>     <span class="co"># Select variables with |loading| &gt; 0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View selected indicators</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span></span></code></pre></div>
<p><strong>Example Output</strong>:</p>
<pre><code>[1] "pH"   "OM"   "Clay" "P"</code></pre>
</div>
<div class="section level3">
<h3 id="id_63-examining-pca-results">6.3 Examining PCA Results<a class="anchor" aria-label="anchor" href="#id_63-examining-pca-results"></a></h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variance explained by each PC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">var_exp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cumulative variance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">var_exp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Variable loadings for first 3 PCs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">loadings</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PCA scores (sample coordinates in PC space)</span></span>
<span><span class="va">pca_scores</span> <span class="op">&lt;-</span> <span class="va">pca_result</span><span class="op">$</span><span class="va">pca</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pca_scores</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_64-adjusting-selection-thresholds">6.4 Adjusting Selection Thresholds<a class="anchor" aria-label="anchor" href="#id_64-adjusting-selection-thresholds"></a></h3>
<p>The thresholds significantly impact MDS composition:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># More conservative (fewer indicators)</span></span>
<span><span class="va">pca_strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pca_select_mds.html">pca_select_mds</a></span><span class="op">(</span></span>
<span>  <span class="va">data_std</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.10</span>,      <span class="co"># Higher variance threshold</span></span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.7</span>     <span class="co"># Higher loading threshold</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pca_strict</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># More inclusive (more indicators)</span></span>
<span><span class="va">pca_relaxed</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pca_select_mds.html">pca_select_mds</a></span><span class="op">(</span></span>
<span>  <span class="va">data_std</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.03</span>,      <span class="co"># Lower variance threshold</span></span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.4</span>     <span class="co"># Lower loading threshold</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pca_relaxed</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span></span></code></pre></div>
<p><strong>Recommendation</strong>: Start with defaults (var_threshold = 0.05, loading_threshold = 0.5) and adjust based on: - Desired MDS size - Domain knowledge - Cumulative variance explained - Practical measurement constraints</p>
</div>
<div class="section level3">
<h3 id="id_65-function-reference">6.5 Function Reference<a class="anchor" aria-label="anchor" href="#id_65-function-reference"></a></h3>
<p><strong>Function</strong>: <code>pca_select_mds(data, var_threshold = 0.05, loading_threshold = 0.5)</code></p>
<p><strong>Parameters</strong>: - <code>data</code>: Standardized data frame with numeric columns - <code>var_threshold</code>: Minimum proportion of variance for PC retention (0-1) - <code>loading_threshold</code>: Minimum absolute loading for variable selection (0-1)</p>
<p><strong>Returns</strong>: List with components: - <code>mds</code>: Character vector of selected variable names - <code>pca</code>: Complete PCA object from <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">stats::prcomp</a></code> - <code>loadings</code>: Rotation matrix (variable loadings) - <code>var_exp</code>: Numeric vector of variance proportions</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_7-analytic-hierarchy-process-for-indicator-weighting">7. Analytic Hierarchy Process for Indicator Weighting<a class="anchor" aria-label="anchor" href="#id_7-analytic-hierarchy-process-for-indicator-weighting"></a></h2>
<div class="section level3">
<h3 id="id_71-understanding-the-saaty-scale">7.1 Understanding the Saaty Scale<a class="anchor" aria-label="anchor" href="#id_71-understanding-the-saaty-scale"></a></h3>
<p>AHP uses pairwise comparisons on a 1-9 scale:</p>
<table class="table"><colgroup><col width="30%"><col width="69%"></colgroup><thead><tr class="header"><th>Value</th>
<th>Interpretation</th>
</tr></thead><tbody><tr class="odd"><td>1</td>
<td>Equal importance</td>
</tr><tr class="even"><td>3</td>
<td>Moderate importance of first over second</td>
</tr><tr class="odd"><td>5</td>
<td>Strong importance of first over second</td>
</tr><tr class="even"><td>7</td>
<td>Very strong importance of first over second</td>
</tr><tr class="odd"><td>9</td>
<td>Extreme importance of first over second</td>
</tr><tr class="even"><td>2, 4, 6, 8</td>
<td>Intermediate values</td>
</tr><tr class="odd"><td>Reciprocals (1/3, 1/5, …)</td>
<td>Second indicator more important than first</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_72-creating-ahp-matrices-programmatically">7.2 Creating AHP Matrices Programmatically<a class="anchor" aria-label="anchor" href="#id_72-creating-ahp-matrices-programmatically"></a></h3>
<p><strong>Method 1: From Importance Ratios</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define relative importance ratios</span></span>
<span><span class="co"># Example: OM is 5x more important than P, which is 3x more important than K</span></span>
<span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>OM <span class="op">=</span> <span class="fl">5</span>, P <span class="op">=</span> <span class="fl">3</span>, K <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to pairwise comparison matrix</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ratio_to_saaty.html">ratio_to_saaty</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pairwise</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>         OM        P        K
OM 1.000000 1.666667 5.000000
P  0.600000 1.000000 3.000000
K  0.200000 0.333333 1.000000</code></pre>
<p><strong>Method 2: Manual Matrix Construction</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create 4x4 pairwise comparison matrix for pH, OM, P, CEC</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span>,   <span class="fl">2</span>,   <span class="fl">3</span>,   <span class="fl">2</span>,    <span class="co"># pH vs others</span></span>
<span>  <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span>,   <span class="fl">2</span>,   <span class="fl">1</span>,    <span class="co"># OM vs others</span></span>
<span>  <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span>,   <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,  <span class="co"># P vs others</span></span>
<span>  <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span>,   <span class="fl">2</span>,   <span class="fl">1</span>     <span class="co"># CEC vs others</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pairwise</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pairwise</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span>, <span class="st">"CEC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pairwise</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_73-calculating-ahp-weights">7.3 Calculating AHP Weights<a class="anchor" aria-label="anchor" href="#id_73-calculating-ahp-weights"></a></h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate weights from pairwise matrix</span></span>
<span><span class="va">ahp_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ahp_weights.html">ahp_weights</a></span><span class="op">(</span></span>
<span>  pairwise <span class="op">=</span> <span class="va">pairwise</span>,</span>
<span>  indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span>, <span class="st">"CEC"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ahp_result</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>       pH        OM         P       CEC
0.3867925 0.2169811 0.1298113 0.2664151</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check consistency</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ahp_result</span><span class="op">$</span><span class="va">CR</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>[1] 0.0234  # CR &lt; 0.10 indicates acceptable consistency</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Maximum eigenvalue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ahp_result</span><span class="op">$</span><span class="va">lambda_max</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_74-interactive-ahp-matrix-creation">7.4 Interactive AHP Matrix Creation<a class="anchor" aria-label="anchor" href="#id_74-interactive-ahp-matrix-creation"></a></h3>
<p>For user-guided pairwise comparisons:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Launch interactive prompts</span></span>
<span><span class="va">ahp_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_ahp_matrix.html">create_ahp_matrix</a></span><span class="op">(</span></span>
<span>  indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"interactive"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Interactive Session Example</strong>:</p>
<pre><code>=== AHP Pairwise Comparison ===

Saaty Scale:
  1 = Equal importance
  3 = Moderate importance
  5 = Strong importance
  7 = Very strong importance
  9 = Extreme importance
  2, 4, 6, 8 = Intermediate values
  Use reciprocals (e.g., 1/3, 0.333) when second indicator is more important

Compare 'pH' vs 'OM'
How much more important is 'pH' compared to 'OM'? 2

Compare 'pH' vs 'P'
How much more important is 'pH' compared to 'P'? 3
...</code></pre>
<p>The function returns an <code>ahp_matrix</code> object:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ahp_matrix</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>=== AHP Pairwise Comparison Matrix ===

Pairwise Comparison Matrix:
     pH    OM     P     K
pH  1.0  2.00  3.00  2.00
OM  0.5  1.00  2.00  1.00
P   0.3  0.50  1.00  0.50
K   0.5  1.00  2.00  1.00

Indicator Weights:
  pH             : 0.3868
  OM             : 0.2170
  P              : 0.1298
  K              : 0.2664

Consistency Information:
  Lambda Max: 4.0230
  Consistency Ratio (CR): 0.0256 [✓ Acceptable]</code></pre>
</div>
<div class="section level3">
<h3 id="id_75-using-pre-built-matrices">7.5 Using Pre-built Matrices<a class="anchor" aria-label="anchor" href="#id_75-using-pre-built-matrices"></a></h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create matrix object from existing pairwise matrix</span></span>
<span><span class="va">ahp_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_ahp_matrix.html">create_ahp_matrix</a></span><span class="op">(</span></span>
<span>  indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"matrix"</span>,</span>
<span>  pairwise <span class="op">=</span> <span class="va">pairwise</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract weights for use in SQI calculation</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">ahp_matrix</span><span class="op">$</span><span class="va">weights</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_76-interpreting-consistency-ratio">7.6 Interpreting Consistency Ratio<a class="anchor" aria-label="anchor" href="#id_76-interpreting-consistency-ratio"></a></h3>
<table class="table"><colgroup><col width="29%"><col width="47%"><col width="23%"></colgroup><thead><tr class="header"><th>CR Value</th>
<th>Interpretation</th>
<th>Action</th>
</tr></thead><tbody><tr class="odd"><td>&lt; 0.10</td>
<td>Acceptable consistency</td>
<td>Proceed with weights</td>
</tr><tr class="even"><td>0.10 - 0.15</td>
<td>Marginal consistency</td>
<td>Review judgments, consider revision</td>
</tr><tr class="odd"><td>&gt; 0.15</td>
<td>Unacceptable inconsistency</td>
<td>Revise pairwise comparisons</td>
</tr></tbody></table><p><strong>Common causes of high CR</strong>: - Circular judgments (A &gt; B &gt; C &gt; A) - Magnitude inconsistencies (A &gt;&gt; B, B ≈ C, but A ≈ C) - Random or uninformed comparisons</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_8-scoring-functions-and-normalization">8. Scoring Functions and Normalization<a class="anchor" aria-label="anchor" href="#id_8-scoring-functions-and-normalization"></a></h2>
<div class="section level3">
<h3 id="id_81-theoretical-foundations">8.1 Theoretical Foundations<a class="anchor" aria-label="anchor" href="#id_81-theoretical-foundations"></a></h3>
<p>Scoring transforms raw soil property values to a normalized 0-1 scale where 1 represents optimal quality. The transformation function depends on the property’s relationship with soil quality.</p>
</div>
<div class="section level3">
<h3 id="id_82-higher-is-better-scoring">8.2 Higher-is-Better Scoring<a class="anchor" aria-label="anchor" href="#id_82-higher-is-better-scoring"></a></h3>
<p>For properties where higher values indicate better quality (e.g., organic matter, nutrients, CEC):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><mrow><mi>x</mi><mo>−</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
S = \frac{x - x_{min}}{x_{max} - x_{min}}
</annotation></semantics></math></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Organic matter scoring</span></span>
<span><span class="va">om_values</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">$</span><span class="va">OM</span></span>
<span><span class="va">om_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_higher_better.html">score_higher_better</a></span><span class="op">(</span><span class="va">om_values</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With custom min/max (for comparison across datasets)</span></span>
<span><span class="va">om_scores_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_higher_better.html">score_higher_better</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">om_values</span>,</span>
<span>  min_val <span class="op">=</span> <span class="fl">1.0</span>,   <span class="co"># Theoretical minimum</span></span>
<span>  max_val <span class="op">=</span> <span class="fl">5.0</span>    <span class="co"># Theoretical maximum</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare distributions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">om_values</span>, main <span class="op">=</span> <span class="st">"Original OM"</span>, xlab <span class="op">=</span> <span class="st">"OM (%)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">om_scores</span>, main <span class="op">=</span> <span class="st">"Scored OM"</span>, xlab <span class="op">=</span> <span class="st">"Score"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>score_higher_better(x, min_val = NULL, max_val = NULL)</code></p>
</div>
<div class="section level3">
<h3 id="id_83-lower-is-better-scoring">8.3 Lower-is-Better Scoring<a class="anchor" aria-label="anchor" href="#id_83-lower-is-better-scoring"></a></h3>
<p>For properties where lower values indicate better quality (e.g., bulk density, salinity):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>−</mo><mi>x</mi></mrow><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
S = \frac{x_{max} - x}{x_{max} - x_{min}}
</annotation></semantics></math></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Bulk density scoring</span></span>
<span><span class="va">bd_values</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">$</span><span class="va">BD</span></span>
<span><span class="va">bd_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_lower_better.html">score_lower_better</a></span><span class="op">(</span><span class="va">bd_values</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With reference values</span></span>
<span><span class="va">bd_scores_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_lower_better.html">score_lower_better</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">bd_values</span>,</span>
<span>  min_val <span class="op">=</span> <span class="fl">1.0</span>,   <span class="co"># Optimal (low) BD</span></span>
<span>  max_val <span class="op">=</span> <span class="fl">1.8</span>    <span class="co"># Poor (high) BD</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify inversion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bd_values</span>, <span class="va">bd_scores</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Bulk Density (g/cm³)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Score"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Lower-is-Better Scoring"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>score_lower_better(x, min_val = NULL, max_val = NULL)</code></p>
</div>
<div class="section level3">
<h3 id="id_84-optimum-range-scoring">8.4 Optimum Range Scoring<a class="anchor" aria-label="anchor" href="#id_84-optimum-range-scoring"></a></h3>
<p>For properties with an optimal value (e.g., pH):</p>
<p><strong>Linear penalty</strong>: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>1</mn><mo>−</mo><mfrac><mrow><mo stretchy="true" form="prefix">|</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mrow><mi>o</mi><mi>p</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mrow><mi>t</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
S = 1 - \frac{|x - x_{opt}|}{tolerance}
</annotation></semantics></math></p>
<p><strong>Quadratic penalty</strong>: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo stretchy="true" form="prefix">|</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mrow><mi>o</mi><mi>p</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mrow><mi>t</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
S = 1 - \left(\frac{|x - x_{opt}|}{tolerance}\right)^2
</annotation></semantics></math></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: pH scoring with linear penalty</span></span>
<span><span class="va">ph_values</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">$</span><span class="va">pH</span></span>
<span><span class="va">ph_scores_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_optimum.html">score_optimum</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">ph_values</span>,</span>
<span>  optimum <span class="op">=</span> <span class="fl">6.5</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  penalty <span class="op">=</span> <span class="st">"linear"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quadratic penalty (more forgiving near optimum)</span></span>
<span><span class="va">ph_scores_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_optimum.html">score_optimum</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">ph_values</span>,</span>
<span>  optimum <span class="op">=</span> <span class="fl">6.5</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  penalty <span class="op">=</span> <span class="st">"quadratic"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize penalty functions</span></span>
<span><span class="va">ph_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">scores_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_optimum.html">score_optimum</a></span><span class="op">(</span><span class="va">ph_range</span>, <span class="fl">6.5</span>, <span class="fl">1.5</span>, <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="va">scores_quad</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_optimum.html">score_optimum</a></span><span class="op">(</span><span class="va">ph_range</span>, <span class="fl">6.5</span>, <span class="fl">1.5</span>, <span class="st">"quadratic"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ph_range</span>, <span class="va">scores_linear</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"pH"</span>, ylab <span class="op">=</span> <span class="st">"Score"</span>, main <span class="op">=</span> <span class="st">"Optimum Range Scoring"</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ph_range</span>, <span class="va">scores_quad</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">6.5</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Linear"</span>, <span class="st">"Quadratic"</span>, <span class="st">"Optimum"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"gray"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>score_optimum(x, optimum, tol, penalty = "linear")</code></p>
</div>
<div class="section level3">
<h3 id="id_85-threshold-based-scoring">8.5 Threshold-Based Scoring<a class="anchor" aria-label="anchor" href="#id_85-threshold-based-scoring"></a></h3>
<p>For properties with expert-defined thresholds:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Phosphorus availability classes</span></span>
<span><span class="va">p_values</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">$</span><span class="va">P</span></span>
<span><span class="va">p_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_threshold.html">score_threshold</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">p_values</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize piecewise linear interpolation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p_values</span>, <span class="va">p_scores</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Available P (mg/kg)"</span>, ylab <span class="op">=</span> <span class="st">"Score"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Threshold-Based Scoring"</span><span class="op">)</span></span></code></pre></div>
<p>Interpretation: - P &lt; 5 mg/kg: Very low (score ≤ 0.3) - P = 5-10 mg/kg: Low (score 0.3-0.6) - P = 10-15 mg/kg: Medium (score 0.6-0.9) - P = 15-25 mg/kg: Adequate (score 0.9-1.0) - P &gt; 25 mg/kg: High (score = 1.0)</p>
<p><strong>Function</strong>: <code>score_threshold(x, thresholds, scores)</code></p>
</div>
<div class="section level3">
<h3 id="id_86-batch-scoring-multiple-indicators">8.6 Batch Scoring Multiple Indicators<a class="anchor" aria-label="anchor" href="#id_86-batch-scoring-multiple-indicators"></a></h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define scoring specifications for multiple indicators</span></span>
<span><span class="va">directions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"optimum"</span>, optimum <span class="op">=</span> <span class="fl">6.5</span>, tol <span class="op">=</span> <span class="fl">1.5</span>, penalty <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span>,</span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"higher"</span><span class="op">)</span>,</span>
<span>  BD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"lower"</span><span class="op">)</span>,</span>
<span>  P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"threshold"</span>,</span>
<span>           thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>           scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"higher"</span>, min_val <span class="op">=</span> <span class="fl">40</span>, max_val <span class="op">=</span> <span class="fl">180</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select MDS indicators</span></span>
<span><span class="va">mds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"BD"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply scoring to all indicators</span></span>
<span><span class="va">scored_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/score_indicators.html">score_indicators</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  mds <span class="op">=</span> <span class="va">mds</span>,</span>
<span>  directions <span class="op">=</span> <span class="va">directions</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View scored columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scored_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"pH_scored"</span>, <span class="st">"OM"</span>, <span class="st">"OM_scored"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>score_indicators(data, mds, directions)</code></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_9-complete-sqi-calculation-workflows">9. Complete SQI Calculation Workflows<a class="anchor" aria-label="anchor" href="#id_9-complete-sqi-calculation-workflows"></a></h2>
<div class="section level3">
<h3 id="id_91-workflow-1-file-based-processing">9.1 Workflow 1: File-Based Processing<a class="anchor" aria-label="anchor" href="#id_91-workflow-1-file-based-processing"></a></h3>
<p>For CSV-based workflows with file input/output:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate SQI from CSV file</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi.html">compute_sqi</a></span><span class="op">(</span></span>
<span>  input_csv <span class="op">=</span> <span class="st">"soil_samples.csv"</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  output_csv <span class="op">=</span> <span class="st">"sqi_results.csv"</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With AHP weights from CSV</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi.html">compute_sqi</a></span><span class="op">(</span></span>
<span>  input_csv <span class="op">=</span> <span class="st">"soil_samples.csv"</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  pairwise_csv <span class="op">=</span> <span class="st">"ahp_matrix.csv"</span>,  <span class="co"># Pre-computed pairwise matrix</span></span>
<span>  output_csv <span class="op">=</span> <span class="st">"sqi_results.csv"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With custom scoring directions</span></span>
<span><span class="va">directions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"optimum"</span>, optimum <span class="op">=</span> <span class="fl">7</span>, tol <span class="op">=</span> <span class="fl">1</span>, penalty <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span>,</span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"higher"</span><span class="op">)</span>,</span>
<span>  P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"higher"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi.html">compute_sqi</a></span><span class="op">(</span></span>
<span>  input_csv <span class="op">=</span> <span class="st">"soil_samples.csv"</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  directions <span class="op">=</span> <span class="va">directions</span>,</span>
<span>  output_csv <span class="op">=</span> <span class="st">"sqi_results.csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>compute_sqi(input_csv, id_column = NULL, pairwise_csv = NULL, output_csv = NULL, directions = NULL, var_threshold = 0.05, loading_threshold = 0.5, ...)</code></p>
</div>
<div class="section level3">
<h3 id="id_92-workflow-2-in-memory-data-frames">9.2 Workflow 2: In-Memory Data Frames<a class="anchor" aria-label="anchor" href="#id_92-workflow-2-in-memory-data-frames"></a></h3>
<p>For interactive analysis with data frames:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic calculation with equal weights</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_df.html">compute_sqi_df</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With AHP weights</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>,</span>
<span>  <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>,</span>
<span>  <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_df.html">compute_sqi_df</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  pairwise_df <span class="op">=</span> <span class="va">pairwise</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">)</span>        <span class="co"># Data frame with scores and SQI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span>           <span class="co"># Selected indicators</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span>       <span class="co"># AHP weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">CR</span><span class="op">)</span>            <span class="co"># Consistency ratio</span></span></code></pre></div>
<p><strong>Function</strong>: <code>compute_sqi_df(df, id_column = NULL, pairwise_df = NULL, directions = NULL, var_threshold = 0.05, loading_threshold = 0.5, ...)</code></p>
</div>
<div class="section level3">
<h3 id="id_93-workflow-3-property-based-calculation-recommended">9.3 Workflow 3: Property-Based Calculation (Recommended)<a class="anchor" aria-label="anchor" href="#id_93-workflow-3-property-based-calculation-recommended"></a></h3>
<p>This enhanced workflow provides explicit control over property selection:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using pre-defined property sets</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">soil_property_sets</span><span class="op">$</span><span class="va">fertility</span>,  <span class="co"># Pre-defined set</span></span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using custom property selection</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With standard scoring rules (automatic rule assignment)</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"BD"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"BD"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">rules</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With custom scoring rules using constructor functions</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pH <span class="op">=</span> <span class="fu"><a href="reference/optimum_range.html">optimum_range</a></span><span class="op">(</span>optimal <span class="op">=</span> <span class="fl">6.5</span>, tolerance <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  OM <span class="op">=</span> <span class="fu"><a href="reference/higher_better.html">higher_better</a></span><span class="op">(</span>min_value <span class="op">=</span> <span class="fl">1</span>, max_value <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  BD <span class="op">=</span> <span class="fu"><a href="reference/lower_better.html">lower_better</a></span><span class="op">(</span>min_value <span class="op">=</span> <span class="fl">1.0</span>, max_value <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span>,</span>
<span>  P <span class="op">=</span> <span class="fu"><a href="reference/threshold_scoring.html">threshold_scoring</a></span><span class="op">(</span></span>
<span>    thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>    scores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fu"><a href="reference/higher_better.html">higher_better</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"BD"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">rules</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With AHP weights</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ratio_to_saaty.html">ratio_to_saaty</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>pH <span class="op">=</span> <span class="fl">3</span>, OM <span class="op">=</span> <span class="fl">5</span>, P <span class="op">=</span> <span class="fl">2</span>, K <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"P"</span>, <span class="st">"K"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  pairwise_matrix <span class="op">=</span> <span class="va">pairwise</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Function</strong>: <code>compute_sqi_properties(data, properties = NULL, id_column = NULL, pairwise_matrix = NULL, scoring_rules = NULL, var_threshold = 0.05, loading_threshold = 0.5, ...)</code></p>
</div>
<div class="section level3">
<h3 id="id_94-pre-defined-property-sets">9.4 Pre-defined Property Sets<a class="anchor" aria-label="anchor" href="#id_94-pre-defined-property-sets"></a></h3>
<p>The package includes six pre-configured property sets:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View available sets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">soil_property_sets</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>[1] "basic"         "standard"      "comprehensive"
[4] "physical"      "chemical"      "fertility"</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic set (minimal assessment)</span></span>
<span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">basic</span></span></code></pre></div>
<pre><code>[1] "pH" "OM" "P"  "K"</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard set (recommended for most assessments)</span></span>
<span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">standard</span></span></code></pre></div>
<pre><code>[1] "Sand" "Silt" "Clay" "pH"   "OM"   "N"    "P"    "K"    "CEC"</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Comprehensive set (detailed characterization)</span></span>
<span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">comprehensive</span></span></code></pre></div>
<pre><code> [1] "Sand" "Silt" "Clay" "pH"   "OM"   "N"    "P"    "K"
 [9] "CEC"  "BD"   "EC"   "Ca"   "Mg"   "Na"   "S"</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Physical properties only</span></span>
<span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">physical</span></span></code></pre></div>
<pre><code>[1] "Sand" "Silt" "Clay" "BD"</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Chemical properties only</span></span>
<span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">chemical</span></span></code></pre></div>
<pre><code>[1] "pH"  "EC"  "CEC" "Ca"  "Mg"  "K"   "Na"</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fertility-related properties</span></span>
<span><span class="va">soil_property_sets</span><span class="op">$</span><span class="va">fertility</span></span></code></pre></div>
<pre><code>[1] "OM"  "N"   "P"   "K"   "Ca"  "Mg"  "S"   "CEC"</code></pre>
</div>
<div class="section level3">
<h3 id="id_95-standard-scoring-rules">9.5 Standard Scoring Rules<a class="anchor" aria-label="anchor" href="#id_95-standard-scoring-rules"></a></h3>
<p>Automatic rule assignment based on property name patterns:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate rules for a property set</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="st">"fertility"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or for custom properties</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"BD"</span>, <span class="st">"OM"</span>, <span class="st">"EC"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect individual rules</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rules</span><span class="op">$</span><span class="va">pH</span><span class="op">)</span></span></code></pre></div>
<p><strong>Output</strong>:</p>
<pre><code>Scoring Rule: optimum_range
  Type: Optimum range
  Optimal value: 7
  Tolerance: 1
  Penalty: linear</code></pre>
<p><strong>Pattern Matching Logic</strong>:</p>
<table class="table"><thead><tr class="header"><th>Pattern</th>
<th>Rule Applied</th>
</tr></thead><tbody><tr class="odd"><td>pH</td>
<td>optimum_range(7, 1)</td>
</tr><tr class="even"><td>EC, electrical</td>
<td>lower_better()</td>
</tr><tr class="odd"><td>BD, bulk</td>
<td>lower_better()</td>
</tr><tr class="even"><td>OM, SOC, organic</td>
<td>higher_better()</td>
</tr><tr class="odd"><td>N, P, K (nutrients)</td>
<td>higher_better()</td>
</tr><tr class="even"><td>CEC, Ca, Mg</td>
<td>higher_better()</td>
</tr><tr class="odd"><td>Others</td>
<td>higher_better() (default)</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_96-complete-example-fertility-assessment">9.6 Complete Example: Fertility Assessment<a class="anchor" aria-label="anchor" href="#id_96-complete-example-fertility-assessment"></a></h3>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step-by-step fertility assessment</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ccarbajal16/soilquality" class="external-link">soilquality</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Select fertility properties</span></span>
<span><span class="va">props</span> <span class="op">&lt;-</span> <span class="va">soil_property_sets</span><span class="op">$</span><span class="va">fertility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Generate standard scoring rules</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Create AHP weights based on nutrient importance</span></span>
<span><span class="co"># Importance order: OM &gt; N &gt; P &gt; CEC &gt; K &gt; Ca &gt; Mg &gt; S</span></span>
<span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>OM <span class="op">=</span> <span class="fl">8</span>, N <span class="op">=</span> <span class="fl">7</span>, P <span class="op">=</span> <span class="fl">6</span>, CEC <span class="op">=</span> <span class="fl">5</span>, K <span class="op">=</span> <span class="fl">4</span>, Ca <span class="op">=</span> <span class="fl">3</span>, Mg <span class="op">=</span> <span class="fl">2</span>, S <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ratio_to_saaty.html">ratio_to_saaty</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">[</span><span class="va">props</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate AHP weights</span></span>
<span><span class="va">ahp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ahp_weights.html">ahp_weights</a></span><span class="op">(</span><span class="va">pairwise</span>, <span class="va">props</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ahp</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Consistency Ratio:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ahp</span><span class="op">$</span><span class="va">CR</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Compute SQI</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="va">props</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">rules</span>,</span>
<span>  pairwise_matrix <span class="op">=</span> <span class="va">pairwise</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Examine results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. Identify samples by quality class</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Quality_Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Poor"</span>, <span class="st">"Fair"</span>, <span class="st">"Good"</span>, <span class="st">"Excellent"</span><span class="op">)</span>,</span>
<span>  include.lowest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Quality_Class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 7. Export results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span>, <span class="st">"fertility_sqi_results.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_10-visualization-and-results-interpretation">10. Visualization and Results Interpretation<a class="anchor" aria-label="anchor" href="#id_10-visualization-and-results-interpretation"></a></h2>
<div class="section level3">
<h3 id="id_101-single-panel-plots">10.1 Single-Panel Plots<a class="anchor" aria-label="anchor" href="#id_101-single-panel-plots"></a></h3>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method provides five visualization types:</p>
<div class="section level4">
<h4 id="id_1011-distribution-plot">10.1.1 Distribution Plot<a class="anchor" aria-label="anchor" href="#id_1011-distribution-plot"></a></h4>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Histogram of SQI values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"distribution"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: - Distribution shape (normal, skewed, bimodal) - Central tendency (mean line) - Range and variability - Outliers or distinct quality groups</p>
</div>
<div class="section level4">
<h4 id="id_1012-indicators-plot">10.1.2 Indicators Plot<a class="anchor" aria-label="anchor" href="#id_1012-indicators-plot"></a></h4>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Boxplots of scored indicators</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"indicators"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: - Relative performance across indicators - Variability within each indicator - Identification of limiting factors - Outlier detection</p>
</div>
<div class="section level4">
<h4 id="id_1013-weights-plot">10.1.3 Weights Plot<a class="anchor" aria-label="anchor" href="#id_1013-weights-plot"></a></h4>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bar chart of AHP weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"weights"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: - Relative importance of each indicator - Dominant vs. minor contributors to SQI - Consistency ratio assessment</p>
</div>
<div class="section level4">
<h4 id="id_1014-scree-plot">10.1.4 Scree Plot<a class="anchor" aria-label="anchor" href="#id_1014-scree-plot"></a></h4>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variance explained by principal components</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"scree"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: - Number of meaningful PCs - Cumulative variance explained - Dimensionality reduction effectiveness - Elbow point identification</p>
</div>
<div class="section level4">
<h4 id="id_1015-pca-biplot">10.1.5 PCA Biplot<a class="anchor" aria-label="anchor" href="#id_1015-pca-biplot"></a></h4>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Biplot of observations and variable loadings</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"biplot"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: - Sample clustering patterns - Variable relationships (correlations) - Influential variables (long arrows) - Sample-variable associations</p>
</div>
</div>
<div class="section level3">
<h3 id="id_102-multi-panel-report">10.2 Multi-Panel Report<a class="anchor" aria-label="anchor" href="#id_102-multi-panel-report"></a></h3>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Comprehensive 4-panel visualization</span></span>
<span><span class="fu"><a href="reference/plot_sqi_report.html">plot_sqi_report</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p>This creates a publication-ready figure with: 1. SQI distribution (top-left) 2. Indicator scores (top-right) 3. AHP weights (bottom-left) 4. Variance scree plot (bottom-right)</p>
</div>
<div class="section level3">
<h3 id="id_103-custom-visualizations">10.3 Custom Visualizations<a class="anchor" aria-label="anchor" href="#id_103-custom-visualizations"></a></h3>
<div class="section level4">
<h4 id="id_1031-spatial-distribution">10.3.1 Spatial Distribution<a class="anchor" aria-label="anchor" href="#id_1031-spatial-distribution"></a></h4>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If samples have coordinates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add coordinates (example)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="op">-</span><span class="fl">74.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="op">-</span><span class="fl">8.4</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create spatial map</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude</span>, y <span class="op">=</span> <span class="va">Latitude</span>, color <span class="op">=</span> <span class="va">SQI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"red"</span>, mid <span class="op">=</span> <span class="st">"yellow"</span>, high <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>                        midpoint <span class="op">=</span> <span class="fl">0.5</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spatial Distribution of Soil Quality Index"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="id_1032-indicator-contribution-analysis">10.3.2 Indicator Contribution Analysis<a class="anchor" aria-label="anchor" href="#id_1032-indicator-contribution-analysis"></a></h4>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate contribution of each indicator to total SQI</span></span>
<span><span class="va">contributions</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"_scored"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">weighted_contrib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">contributions</span>, <span class="fl">2</span>, <span class="va">result</span><span class="op">$</span><span class="va">weights</span>, <span class="st">"*"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">weighted_contrib</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"_contrib"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add to results</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span>, <span class="va">weighted_contrib</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Average contribution</span></span>
<span><span class="va">avg_contrib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">weighted_contrib</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">avg_contrib</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Average Contribution to SQI"</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Contribution"</span>,</span>
<span>        las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="id_1033-quality-classification">10.3.3 Quality Classification<a class="anchor" aria-label="anchor" href="#id_1033-quality-classification"></a></h4>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define quality classes</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Poor"</span>, <span class="st">"Fair"</span>, <span class="st">"Good"</span>, <span class="st">"Excellent"</span><span class="op">)</span>,</span>
<span>  include.lowest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize class distribution</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Class</span>, fill <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of Soil Quality Classes"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Quality Class"</span>, y <span class="op">=</span> <span class="st">"Number of Samples"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="id_104-statistical-summaries">10.4 Statistical Summaries<a class="anchor" aria-label="anchor" href="#id_104-statistical-summaries"></a></h3>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summary statistics for SQI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># By quality class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>, <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Class</span>, <span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correlation between SQI and original properties</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"SQI"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   use <span class="op">=</span> <span class="st">"complete.obs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">[</span>, <span class="st">"SQI"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify most influential indicator</span></span>
<span><span class="va">max_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cor_matrix</span><span class="op">[</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"SQI"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Most correlated with SQI:"</span>, <span class="va">result</span><span class="op">$</span><span class="va">mds</span><span class="op">[</span><span class="va">max_cor</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_11-advanced-applications">11. Advanced Applications<a class="anchor" aria-label="anchor" href="#id_11-advanced-applications"></a></h2>
<div class="section level3">
<h3 id="id_111-comparing-management-systems">11.1 Comparing Management Systems<a class="anchor" aria-label="anchor" href="#id_111-comparing-management-systems"></a></h3>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add management system identifier</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Management</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Conventional"</span>, <span class="st">"Organic"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare SQI by system</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">SQI</span> <span class="op">~</span> <span class="va">Management</span>, data <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">results</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"SQI by Management System"</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Soil Quality Index"</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"lightgreen"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Statistical test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">SQI</span> <span class="op">~</span> <span class="va">Management</span>, data <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare by indicator</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="va">scored_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"_scored"</span><span class="op">)</span></span>
<span><span class="va">scores_long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Management"</span>, <span class="va">scored_cols</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    id.vars <span class="op">=</span> <span class="st">"Management"</span>,</span>
<span>                    variable.name <span class="op">=</span> <span class="st">"Indicator"</span>,</span>
<span>                    value.name <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">scores_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Indicator</span>, y <span class="op">=</span> <span class="va">Score</span>, fill <span class="op">=</span> <span class="va">Management</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Indicator Scores by Management System"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_112-temporal-changes">11.2 Temporal Changes<a class="anchor" aria-label="anchor" href="#id_112-temporal-changes"></a></h3>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate multi-year data</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2021</span>, <span class="fl">2022</span>, <span class="fl">2023</span><span class="op">)</span></span>
<span><span class="va">temporal_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">year</span> <span class="kw">in</span> <span class="va">years</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># In practice, load data for each year</span></span>
<span>  <span class="co"># Here we simulate slight changes</span></span>
<span>  <span class="va">data_year</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span></span>
<span>  <span class="va">data_year</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data_year</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span><span class="op">)</span><span class="op">]</span> <span class="op">*</span></span>
<span>                                     <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">year</span> <span class="op">-</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">result_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data_year</span>,</span>
<span>    properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span>,</span>
<span>    id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>    scoring_rules <span class="op">=</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">temporal_results</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_year</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create temporal data frame</span></span>
<span><span class="va">temporal_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">years</span>, each <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  SampleID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">$</span><span class="va">SampleID</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  SQI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">temporal_results</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Temporal trend</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">temporal_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">SQI</span>, group <span class="op">=</span> <span class="va">SampleID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">mean</span>, geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Temporal Trends in Soil Quality"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Soil Quality Index"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_113-sensitivity-analysis">11.3 Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#id_113-sensitivity-analysis"></a></h3>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test sensitivity to PCA thresholds</span></span>
<span><span class="va">var_thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.05</span>, <span class="fl">0.07</span>, <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="va">sensitivity_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">vt</span> <span class="kw">in</span> <span class="va">var_thresholds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>    properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sand"</span>, <span class="st">"Silt"</span>, <span class="st">"Clay"</span>, <span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span>,</span>
<span>    id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>    var_threshold <span class="op">=</span> <span class="va">vt</span>,</span>
<span>    loading_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">sensitivity_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">sensitivity_results</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    var_threshold <span class="op">=</span> <span class="va">vt</span>,</span>
<span>    n_indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_test</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span>,</span>
<span>    mean_SQI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result_test</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>,</span>
<span>    sd_SQI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">result_test</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>,</span>
<span>    indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">result_test</span><span class="op">$</span><span class="va">mds</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sensitivity_results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot sensitivity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sensitivity_results</span><span class="op">$</span><span class="va">var_threshold</span>, <span class="va">sensitivity_results</span><span class="op">$</span><span class="va">mean_SQI</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Variance Threshold"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Mean SQI"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Sensitivity to Variance Threshold"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_114-bootstrap-confidence-intervals">11.4 Bootstrap Confidence Intervals<a class="anchor" aria-label="anchor" href="#id_114-bootstrap-confidence-intervals"></a></h3>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bootstrap SQI calculation</span></span>
<span><span class="va">n_boot</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">boot_sqi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">n_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_boot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Resample observations</span></span>
<span>  <span class="va">boot_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">boot_data</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">[</span><span class="va">boot_indices</span>, <span class="op">]</span></span>
<span></span>
<span>  <span class="va">boot_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">boot_data</span>,</span>
<span>    properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span>,</span>
<span>    id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">boot_sqi</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">boot_result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">$</span><span class="va">SampleID</span>,</span>
<span>                                                   <span class="va">boot_result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SampleID</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate 95% confidence intervals</span></span>
<span><span class="va">ci_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_sqi</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.025</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ci_upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_sqi</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.975</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Original SQI</span></span>
<span><span class="va">original_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with confidence intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="va">original_result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Sample"</span>, ylab <span class="op">=</span> <span class="st">"SQI"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"SQI with 95% Bootstrap Confidence Intervals"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="va">ci_lower</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="va">ci_upper</span>,</span>
<span>       angle <span class="op">=</span> <span class="fl">90</span>, code <span class="op">=</span> <span class="fl">3</span>, length <span class="op">=</span> <span class="fl">0.05</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_115-machine-learning-integration">11.5 Machine Learning Integration<a class="anchor" aria-label="anchor" href="#id_115-machine-learning-integration"></a></h3>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use SQI as target variable for prediction</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data</span></span>
<span><span class="va">ml_data</span> <span class="op">&lt;-</span> <span class="va">soil_ucayali</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sand"</span>, <span class="st">"Silt"</span>, <span class="st">"Clay"</span>, <span class="st">"pH"</span>, <span class="st">"OM"</span>,</span>
<span>                              <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span>, <span class="st">"BD"</span>, <span class="st">"EC"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ml_data</span><span class="op">$</span><span class="va">SQI</span> <span class="op">&lt;-</span> <span class="va">original_result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span></span>
<span></span>
<span><span class="co"># Split data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ml_data</span><span class="op">)</span>, <span class="fl">0.7</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ml_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">ml_data</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">ml_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Train random forest</span></span>
<span><span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">SQI</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, ntree <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_model</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="va">test_data</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">SQI</span>, <span class="va">predictions</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Observed SQI"</span>, ylab <span class="op">=</span> <span class="st">"Predicted SQI"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Random Forest Prediction of SQI"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Variable importance</span></span>
<span><span class="fu">varImpPlot</span><span class="op">(</span><span class="va">rf_model</span>, main <span class="op">=</span> <span class="st">"Importance of Soil Properties for SQI"</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_12-interactive-shiny-application">12. Interactive Shiny Application<a class="anchor" aria-label="anchor" href="#id_12-interactive-shiny-application"></a></h2>
<div class="section level3">
<h3 id="id_121-launching-the-application">12.1 Launching the Application<a class="anchor" aria-label="anchor" href="#id_121-launching-the-application"></a></h3>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Launch with default settings</span></span>
<span><span class="fu"><a href="reference/run_sqi_app.html">run_sqi_app</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Launch on specific port</span></span>
<span><span class="fu"><a href="reference/run_sqi_app.html">run_sqi_app</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fl">8080</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Don't open browser automatically</span></span>
<span><span class="fu"><a href="reference/run_sqi_app.html">run_sqi_app</a></span><span class="op">(</span>launch.browser <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_122-application-features">12.2 Application Features<a class="anchor" aria-label="anchor" href="#id_122-application-features"></a></h3>
<p>The Shiny app provides a graphical interface for:</p>
<ol style="list-style-type: decimal"><li>
<strong>Data Upload</strong>
<ul><li>CSV file upload</li>
<li>Data preview</li>
<li>Column selection</li>
</ul></li>
<li>
<strong>Property Selection</strong>
<ul><li>Auto-detect numeric columns</li>
<li>Pre-defined property sets</li>
<li>Custom selection</li>
</ul></li>
<li>
<strong>Scoring Configuration</strong>
<ul><li>Standard rules (automatic)</li>
<li>All higher-better</li>
<li>Custom rules (advanced)</li>
</ul></li>
<li>
<strong>Weight Specification</strong>
<ul><li>Equal weights</li>
<li>Upload AHP matrix</li>
<li>Interactive pairwise comparisons</li>
</ul></li>
<li>
<strong>Results Display</strong>
<ul><li>Summary statistics</li>
<li>Interactive data table</li>
<li>Downloadable results</li>
</ul></li>
<li>
<strong>Visualizations</strong>
<ul><li>Distribution plots</li>
<li>Indicator scores</li>
<li>Weights visualization</li>
<li>Scree plots</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="id_123-typical-workflow-in-shiny-app">12.3 Typical Workflow in Shiny App<a class="anchor" aria-label="anchor" href="#id_123-typical-workflow-in-shiny-app"></a></h3>
<ol style="list-style-type: decimal"><li>Click “Browse” to upload CSV file</li>
<li>Verify data preview</li>
<li>Select ID column from dropdown</li>
<li>Choose property selection method:
<ul><li>“Auto-detect” for all numeric columns</li>
<li>“Pre-defined” for standard sets</li>
<li>“Custom” for manual selection</li>
</ul></li>
<li>Configure scoring rules (or use defaults)</li>
<li>Set PCA thresholds (or use defaults)</li>
<li>Choose weighting method (equal or AHP)</li>
<li>Click “Calculate SQI”</li>
<li>Review results in Results tab</li>
<li>Explore visualizations in Plots tab</li>
<li>Download results CSV</li>
</ol><hr></div>
</div>
<div class="section level2">
<h2 id="id_13-best-practices-and-recommendations">13. Best Practices and Recommendations<a class="anchor" aria-label="anchor" href="#id_13-best-practices-and-recommendations"></a></h2>
<div class="section level3">
<h3 id="id_131-data-quality">13.1 Data Quality<a class="anchor" aria-label="anchor" href="#id_131-data-quality"></a></h3>
<p><strong>Pre-analysis checks</strong>: - Remove duplicates - Check for outliers (use <code><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>) - Verify data types (<code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code>) - Handle missing values appropriately - Ensure consistent units across samples</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example quality control</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check missing data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove samples with &gt;30% missing values</span></span>
<span><span class="va">complete_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">soil_data</span><span class="op">)</span></span>
<span><span class="va">soil_clean</span> <span class="op">&lt;-</span> <span class="va">soil_data</span><span class="op">[</span><span class="va">complete_ratio</span> <span class="op">&gt;</span> <span class="fl">0.7</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_132-property-selection">13.2 Property Selection<a class="anchor" aria-label="anchor" href="#id_132-property-selection"></a></h3>
<p><strong>Guidelines</strong>: - Minimum 5-8 properties for robust PCA - Include properties from multiple categories (physical, chemical, fertility) - Consider measurement cost vs. information gain - Ensure properties are relevant to study objectives - Avoid highly correlated redundant properties</p>
<p><strong>Example balanced selection</strong>:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Balanced property set</span></span>
<span><span class="va">properties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Clay"</span>,    <span class="co"># Physical</span></span>
<span>  <span class="st">"BD"</span>,      <span class="co"># Physical</span></span>
<span>  <span class="st">"pH"</span>,      <span class="co"># Chemical</span></span>
<span>  <span class="st">"OM"</span>,      <span class="co"># Chemical</span></span>
<span>  <span class="st">"CEC"</span>,     <span class="co"># Chemical</span></span>
<span>  <span class="st">"N"</span>,       <span class="co"># Fertility</span></span>
<span>  <span class="st">"P"</span>,       <span class="co"># Fertility</span></span>
<span>  <span class="st">"K"</span>        <span class="co"># Fertility</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_133-mds-selection-thresholds">13.3 MDS Selection Thresholds<a class="anchor" aria-label="anchor" href="#id_133-mds-selection-thresholds"></a></h3>
<p><strong>Recommendations</strong>: - <code>var_threshold = 0.05</code>: Standard, retains PCs explaining &gt;5% variance - <code>loading_threshold = 0.5</code>: Standard, selects variables with strong loadings</p>
<p><strong>Adjust based on</strong>: - Sample size (smaller n → lower thresholds) - Number of variables (more variables → higher thresholds) - Explained variance (aim for cumulative &gt;70%)</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check cumulative variance before finalizing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">var_exp</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_134-ahp-weight-assignment">13.4 AHP Weight Assignment<a class="anchor" aria-label="anchor" href="#id_134-ahp-weight-assignment"></a></h3>
<p><strong>Best practices</strong>: - Base comparisons on scientific literature - Consult domain experts - Use consistent logic across comparisons - Document rationale for judgments - Always check CR &lt; 0.10 - Revise if CR &gt; 0.10</p>
<p><strong>Example documentation</strong>:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expert weights based on literature review</span></span>
<span><span class="co"># Rationale: OM most important for tropical soils (Lal, 2006)</span></span>
<span><span class="co">#            pH critical for nutrient availability (Brady &amp; Weil, 2008)</span></span>
<span><span class="co">#            P limiting in weathered soils (Sanchez, 1976)</span></span>
<span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>OM <span class="op">=</span> <span class="fl">5</span>, pH <span class="op">=</span> <span class="fl">3</span>, P <span class="op">=</span> <span class="fl">2</span>, K <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_135-scoring-function-selection">13.5 Scoring Function Selection<a class="anchor" aria-label="anchor" href="#id_135-scoring-function-selection"></a></h3>
<p><strong>Decision tree</strong>:</p>
<ol style="list-style-type: decimal"><li>
<strong>Monotonic positive</strong> (higher = better) → <code><a href="reference/higher_better.html">higher_better()</a></code>
<ul><li>Nutrients (N, P, K, Ca, Mg)</li>
<li>Organic matter</li>
<li>CEC</li>
<li>Water holding capacity</li>
</ul></li>
<li>
<strong>Monotonic negative</strong> (lower = better) → <code><a href="reference/lower_better.html">lower_better()</a></code>
<ul><li>Bulk density</li>
<li>Salinity (EC)</li>
<li>Sodium (Na)</li>
<li>Compaction</li>
</ul></li>
<li>
<strong>Optimum</strong> (target value) → <code><a href="reference/optimum_range.html">optimum_range()</a></code>
<ul><li>pH (most crops: 6.0-7.0)</li>
<li>C:N ratio</li>
<li>Base saturation</li>
</ul></li>
<li>
<strong>Threshold</strong> (custom classes) → <code><a href="reference/threshold_scoring.html">threshold_scoring()</a></code>
<ul><li>Regulatory limits</li>
<li>Crop-specific requirements</li>
<li>Local standards</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="id_136-interpretation-guidelines">13.6 Interpretation Guidelines<a class="anchor" aria-label="anchor" href="#id_136-interpretation-guidelines"></a></h3>
<p><strong>SQI Value Ranges</strong> (suggested):</p>
<table class="table"><colgroup><col width="25%"><col width="37%"><col width="37%"></colgroup><thead><tr class="header"><th>SQI Range</th>
<th>Classification</th>
<th>Interpretation</th>
</tr></thead><tbody><tr class="odd"><td>0.00 - 0.25</td>
<td>Poor</td>
<td>Severe limitations, rehabilitation needed</td>
</tr><tr class="even"><td>0.26 - 0.50</td>
<td>Fair</td>
<td>Moderate limitations, management improvements recommended</td>
</tr><tr class="odd"><td>0.51 - 0.75</td>
<td>Good</td>
<td>Minor limitations, suitable for most uses</td>
</tr><tr class="even"><td>0.76 - 1.00</td>
<td>Excellent</td>
<td>No significant limitations, optimal quality</td>
</tr></tbody></table><p><strong>Context matters</strong>: - Reference to regional baselines - Land use objectives - Management history - Climatic conditions</p>
</div>
<div class="section level3">
<h3 id="id_137-reporting-results">13.7 Reporting Results<a class="anchor" aria-label="anchor" href="#id_137-reporting-results"></a></h3>
<p><strong>Minimum reporting requirements</strong>:</p>
<ol style="list-style-type: decimal"><li>
<strong>Methods</strong>
<ul><li>Properties included</li>
<li>PCA thresholds used</li>
<li>MDS indicators selected</li>
<li>Scoring functions applied</li>
<li>Weighting method (equal or AHP)</li>
<li>AHP matrix and CR (if applicable)</li>
</ul></li>
<li>
<strong>Results</strong>
<ul><li>Summary statistics (mean, SD, range)</li>
<li>SQI distribution histogram</li>
<li>Indicator scores boxplots</li>
<li>Sample classifications</li>
</ul></li>
<li>
<strong>Interpretation</strong>
<ul><li>Comparison to reference values</li>
<li>Limiting factors identification</li>
<li>Management recommendations</li>
<li>Temporal trends (if applicable)</li>
</ul></li>
</ol><p><strong>Example report template</strong>:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate report</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== SOIL QUALITY INDEX REPORT ===\n\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1. METHODS\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Properties analyzed:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"PCA variance explained:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">var_exp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Weighting method:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">CR</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"Equal"</span>, <span class="st">"AHP"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">CR</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"AHP Consistency Ratio:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">CR</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"2. RESULTS\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean SQI:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SD:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"-"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"3. QUALITY CLASSIFICATION\n"</span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>,</span>
<span>                             breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                             labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Poor"</span>, <span class="st">"Fair"</span>, <span class="st">"Good"</span>, <span class="st">"Excellent"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_14-references">14. References<a class="anchor" aria-label="anchor" href="#id_14-references"></a></h2>
<p>Andrews, S. S., Karlen, D. L., &amp; Mitchell, J. P. (2002). A comparison of soil quality indexing methods for vegetable production systems in Northern California. <em>Agriculture, Ecosystems &amp; Environment</em>, 90(1), 25-45.</p>
<p>Brady, N. C., &amp; Weil, R. R. (2008). <em>The Nature and Properties of Soils</em> (14th ed.). Pearson Prentice Hall.</p>
<p>Karlen, D. L., Mausbach, M. J., Doran, J. W., Cline, R. G., Harris, R. F., &amp; Schuman, G. E. (1997). Soil quality: A concept, definition, and framework for evaluation. <em>Soil Science Society of America Journal</em>, 61(1), 4-10.</p>
<p>Lal, R. (2006). Enhancing crop yields in the developing countries through restoration of the soil organic carbon pool in agricultural lands. <em>Land Degradation &amp; Development</em>, 17(2), 197-209.</p>
<p>Saaty, T. L. (1980). <em>The Analytic Hierarchy Process</em>. McGraw-Hill.</p>
<p>Sanchez, P. A. (1976). <em>Properties and Management of Soils in the Tropics</em>. Wiley.</p>
<p>Shukla, M. K., Lal, R., &amp; Ebinger, M. (2006). Determining soil quality indicators by factor analysis. <em>Soil and Tillage Research</em>, 87(2), 194-204.</p>
<hr></div>
<div class="section level2">
<h2 id="appendix-a-complete-example-script">Appendix A: Complete Example Script<a class="anchor" aria-label="anchor" href="#appendix-a-complete-example-script"></a></h2>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># =============================================================================</span></span>
<span><span class="co"># COMPLETE SOIL QUALITY INDEX WORKFLOW</span></span>
<span><span class="co"># Using soilquality package v1.0.0</span></span>
<span><span class="co"># =============================================================================</span></span>
<span></span>
<span><span class="co"># Load package and data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ccarbajal16/soilquality" class="external-link">soilquality</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. DATA EXPLORATION</span></span>
<span><span class="co"># -------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pH"</span>, <span class="st">"OM"</span>, <span class="st">"N"</span>, <span class="st">"P"</span>, <span class="st">"K"</span>, <span class="st">"CEC"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. PROPERTY SELECTION</span></span>
<span><span class="co"># ---------------------</span></span>
<span><span class="co"># Use standard fertility set</span></span>
<span><span class="va">properties</span> <span class="op">&lt;-</span> <span class="va">soil_property_sets</span><span class="op">$</span><span class="va">fertility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. SCORING RULES</span></span>
<span><span class="co"># ----------------</span></span>
<span><span class="co"># Generate standard rules</span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/standard_scoring_rules.html">standard_scoring_rules</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Customize pH rule</span></span>
<span><span class="va">rules</span><span class="op">$</span><span class="va">pH</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/optimum_range.html">optimum_range</a></span><span class="op">(</span>optimal <span class="op">=</span> <span class="fl">6.5</span>, tolerance <span class="op">=</span> <span class="fl">1.5</span>, penalty <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View rules</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">rules</span>, <span class="va">print</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. AHP WEIGHTS</span></span>
<span><span class="co"># --------------</span></span>
<span><span class="co"># Define importance ratios based on nutrient function</span></span>
<span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>OM <span class="op">=</span> <span class="fl">7</span>, N <span class="op">=</span> <span class="fl">6</span>, P <span class="op">=</span> <span class="fl">5</span>, CEC <span class="op">=</span> <span class="fl">4</span>, K <span class="op">=</span> <span class="fl">3</span>, Ca <span class="op">=</span> <span class="fl">2</span>, Mg <span class="op">=</span> <span class="fl">2</span>, S <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only use properties actually in the dataset</span></span>
<span><span class="va">available_props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">soil_ucayali</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="va">ratios</span><span class="op">[</span><span class="va">available_props</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create pairwise matrix</span></span>
<span><span class="va">pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ratio_to_saaty.html">ratio_to_saaty</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate weights</span></span>
<span><span class="va">ahp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ahp_weights.html">ahp_weights</a></span><span class="op">(</span><span class="va">pairwise</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ahp</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CR:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ahp</span><span class="op">$</span><span class="va">CR</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. COMPUTE SQI</span></span>
<span><span class="co"># --------------</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute_sqi_properties.html">compute_sqi_properties</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">soil_ucayali</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span>,</span>
<span>  id_column <span class="op">=</span> <span class="st">"SampleID"</span>,</span>
<span>  scoring_rules <span class="op">=</span> <span class="va">rules</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  pairwise_matrix <span class="op">=</span> <span class="va">pairwise</span>,</span>
<span>  var_threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  loading_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. EXAMINE RESULTS</span></span>
<span><span class="co"># ------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View selected MDS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View final weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 7. CLASSIFY SAMPLES</span></span>
<span><span class="co"># -------------------</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Quality_Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Poor"</span>, <span class="st">"Fair"</span>, <span class="st">"Good"</span>, <span class="st">"Excellent"</span><span class="op">)</span>,</span>
<span>  include.lowest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">Quality_Class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 8. VISUALIZATIONS</span></span>
<span><span class="co"># -----------------</span></span>
<span><span class="co"># Distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"distribution"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Indicators</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"indicators"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"weights"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scree plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"scree"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Comprehensive report</span></span>
<span><span class="fu"><a href="reference/plot_sqi_report.html">plot_sqi_report</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 9. EXPORT RESULTS</span></span>
<span><span class="co"># -----------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span>, <span class="st">"sqi_results.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 10. DETAILED ANALYSIS</span></span>
<span><span class="co"># ---------------------</span></span>
<span><span class="co"># Top 10 highest quality samples</span></span>
<span><span class="va">top10</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SampleID"</span>, <span class="st">"SQI"</span>, <span class="st">"Quality_Class"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">top10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bottom 10 lowest quality samples</span></span>
<span><span class="va">bottom10</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">SQI</span><span class="op">)</span>, <span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SampleID"</span>, <span class="st">"SQI"</span>, <span class="st">"Quality_Class"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bottom10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Limiting factors analysis</span></span>
<span><span class="va">scored_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">mds</span>, <span class="st">"_scored"</span><span class="op">)</span></span>
<span><span class="va">limiting_factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">[</span>, <span class="va">scored_cols</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">which.min</span><span class="op">)</span></span>
<span><span class="va">limiting_indicator</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">mds</span><span class="op">[</span><span class="va">limiting_factors</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">limiting_indicator</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Analysis complete!"</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level2">
<h2 id="appendix-b-function-quick-reference">Appendix B: Function Quick Reference<a class="anchor" aria-label="anchor" href="#appendix-b-function-quick-reference"></a></h2>
<table class="table"><colgroup><col width="28%"><col width="25%"><col width="45%"></colgroup><thead><tr class="header"><th>Function</th>
<th>Purpose</th>
<th>Key Parameters</th>
</tr></thead><tbody><tr class="odd"><td><code><a href="reference/read_soil_csv.html">read_soil_csv()</a></code></td>
<td>Import CSV data</td>
<td>path</td>
</tr><tr class="even"><td><code><a href="reference/to_numeric.html">to_numeric()</a></code></td>
<td>Convert to numeric</td>
<td>x</td>
</tr><tr class="odd"><td><code><a href="reference/standardize_numeric.html">standardize_numeric()</a></code></td>
<td>Z-score standardization</td>
<td>df, exclude</td>
</tr><tr class="even"><td><code><a href="reference/pca_select_mds.html">pca_select_mds()</a></code></td>
<td>PCA-based MDS selection</td>
<td>data, var_threshold, loading_threshold</td>
</tr><tr class="odd"><td><code><a href="reference/ratio_to_saaty.html">ratio_to_saaty()</a></code></td>
<td>Convert ratios to pairwise matrix</td>
<td>ratios</td>
</tr><tr class="even"><td><code><a href="reference/ahp_weights.html">ahp_weights()</a></code></td>
<td>Calculate AHP weights</td>
<td>pairwise, indicators</td>
</tr><tr class="odd"><td><code><a href="reference/create_ahp_matrix.html">create_ahp_matrix()</a></code></td>
<td>Interactive/programmatic AHP</td>
<td>indicators, mode, pairwise</td>
</tr><tr class="even"><td><code><a href="reference/score_higher_better.html">score_higher_better()</a></code></td>
<td>Higher-is-better scoring</td>
<td>x, min_val, max_val</td>
</tr><tr class="odd"><td><code><a href="reference/score_lower_better.html">score_lower_better()</a></code></td>
<td>Lower-is-better scoring</td>
<td>x, min_val, max_val</td>
</tr><tr class="even"><td><code><a href="reference/score_optimum.html">score_optimum()</a></code></td>
<td>Optimum range scoring</td>
<td>x, optimum, tol, penalty</td>
</tr><tr class="odd"><td><code><a href="reference/score_threshold.html">score_threshold()</a></code></td>
<td>Threshold-based scoring</td>
<td>x, thresholds, scores</td>
</tr><tr class="even"><td><code><a href="reference/score_indicators.html">score_indicators()</a></code></td>
<td>Batch scoring</td>
<td>data, mds, directions</td>
</tr><tr class="odd"><td><code><a href="reference/higher_better.html">higher_better()</a></code></td>
<td>Create higher rule</td>
<td>min_value, max_value</td>
</tr><tr class="even"><td><code><a href="reference/lower_better.html">lower_better()</a></code></td>
<td>Create lower rule</td>
<td>min_value, max_value</td>
</tr><tr class="odd"><td><code><a href="reference/optimum_range.html">optimum_range()</a></code></td>
<td>Create optimum rule</td>
<td>optimal, tolerance, penalty</td>
</tr><tr class="even"><td><code><a href="reference/threshold_scoring.html">threshold_scoring()</a></code></td>
<td>Create threshold rule</td>
<td>thresholds, scores</td>
</tr><tr class="odd"><td><code><a href="reference/standard_scoring_rules.html">standard_scoring_rules()</a></code></td>
<td>Auto-generate rules</td>
<td>properties</td>
</tr><tr class="even"><td><code><a href="reference/compute_sqi.html">compute_sqi()</a></code></td>
<td>File-based SQI</td>
<td>input_csv, id_column, pairwise_csv, output_csv</td>
</tr><tr class="odd"><td><code><a href="reference/compute_sqi_df.html">compute_sqi_df()</a></code></td>
<td>Data frame SQI</td>
<td>df, id_column, pairwise_df</td>
</tr><tr class="even"><td><code><a href="reference/compute_sqi_properties.html">compute_sqi_properties()</a></code></td>
<td>Property-based SQI</td>
<td>data, properties, scoring_rules, pairwise_matrix</td>
</tr><tr class="odd"><td><code><a href="reference/plot.sqi_result.html">plot.sqi_result()</a></code></td>
<td>Single plot</td>
<td>x, type</td>
</tr><tr class="even"><td><code><a href="reference/plot_sqi_report.html">plot_sqi_report()</a></code></td>
<td>Multi-panel report</td>
<td>x</td>
</tr><tr class="odd"><td><code><a href="reference/run_sqi_app.html">run_sqi_app()</a></code></td>
<td>Launch Shiny app</td>
<td>launch.browser</td>
</tr></tbody></table><hr><p><strong>End of User Guide</strong></p>
<p>For additional support, please visit: - Package website: <a href="https://ccarbajal16.github.io/soilquality/" class="uri">https://ccarbajal16.github.io/soilquality/</a> - GitHub repository: <a href="https://github.com/ccarbajal16/soilquality" class="external-link uri">https://github.com/ccarbajal16/soilquality</a> - Issue tracker: <a href="https://github.com/ccarbajal16/soilquality/issues" class="external-link uri">https://github.com/ccarbajal16/soilquality/issues</a></p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Carlos Carbajal</p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a></p>
</div>

    </footer></div>





  </body></html>

